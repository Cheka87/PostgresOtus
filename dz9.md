 1. Настройте выполнение контрольной точки раз в 30 секунд.

    alter system set checkpoint_timeout='30s';

 2. 10 минут c помощью утилиты pgbench подавайте нагрузку.

    *current_wal_lsn до подачи нагрузки*

    0/293E7818

    Создаем таблицы для нагрузочного тестирования утилитой pgbench

    pgbench -i buffer_temp

    Запускам нагрузку на 10 минут:

    *sudo -u postgres  pgbench -c8 -P 6 -T 600 -U postgres buffer_temp*

    *current_wal_lsn после остановки нагрузки*

    0/52EB5788

 3. Объем сгенерированных wal-файлов:

    667MB

    Количество контрольных точек:

    35
 4. Контрольные точки выполнялись по расписанию.

 5. Разница между синхронным и асинхронными режимами примерно вдвое, из-за более быстрого сбрасывания на диск.

 6. Включение контрольной суммы гарантирует целостность файлов.

    При запуске сервер выдаст сообщение о повреждении файлов.

    Вариантов решения несколько:

    1. Удалить поврежденные строки, если данные не критичны.

    2. Применить зануление поврежденных строк, выполнив:

       set zero_damaged_pages = on;

       После этого сделать vacuum full по поврежденной таблице.


